<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Home Dashboard</title>
    <style>
        /* --- GENEL SAYFA STÄ°LLERÄ° --- */
        body { 
            background-color: #1a1a1a; 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            text-align: center; 
            padding: 40px; 
            margin: 0;
        }

        h1 { margin-bottom: 40px; font-weight: 300; letter-spacing: 2px; }

        /* --- KART IZGARASI (GRID) --- */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 25px; 
            max-width: 1000px; 
            margin: 0 auto; 
        }

        /* --- CÄ°HAZ KARTLARI --- */
        .card { 
            background: #2d2d2d; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s, background-color 0.3s; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .card:hover { transform: translateY(-5px); background: #333; }
        
        .icon { font-size: 50px; margin-bottom: 15px; display: block; }
        
        h3 { margin: 10px 0 5px 0; font-size: 16px; color: #aaa; }
        
        p { font-size: 18px; margin: 0; font-weight: bold; }

        /* --- STANDART DURUM RENKLERÄ° --- */
        /* AÃ§Ä±k / Pozitif Durumlar (YeÅŸil) */
        .status-on, .status-open, .status-unlocked, .status-unlock { 
            color: #4caf50; 
            text-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        } 
        
        /* KapalÄ± / Negatif Durumlar (KÄ±rmÄ±zÄ±) */
        .status-off, .status-closed, .status-locked, .status-lock { 
            color: #f44336; 
        } 
        
        /* --- TERMOSTAT Ã–ZEL RENKLERÄ° --- */
        /* VeritabanÄ±ndaki "set_mode_..." isimleriyle birebir eÅŸleÅŸir */
        
        .status-set_mode_cool { 
            color: #2196f3; /* Mavi */
            text-shadow: 0 0 10px #2196f3; 
        } 
        
        .status-heat { 
            color: #ff5722; /* Turuncu/AteÅŸ */
            text-shadow: 0 0 10px #ff5722; 
        } 
        
        .status-fan_only { 
            color: #00bcd4; /* Cam GÃ¶beÄŸi */
        } 
        
        .status-auto { 
            color: #9c27b0; /* Mor */
        }
        
        .status-off {
            color: #757575; /* Gri */
        }

    </style>
</head>
<body>

    <h1>ğŸ  Agent Control Center</h1>
    
    <div id="dashboard" class="grid">
        Loading devices...
    </div>

    <script>
        // Cihazlar iÃ§in ikon eÅŸleÅŸtirmeleri
        const icons = { 
            "light": "ğŸ’¡", 
            "tv": "ğŸ“º", 
            "curtain": "ğŸªŸ", 
            "door_lock": "ğŸ”’", 
            "thermostat_mode": "ğŸŒ¡ï¸", 
            "main_water_valve": "ğŸš°" 
        };

        async function update() {
            try {
                // API'den durumu Ã§ek
                const res = await fetch('/status'); 
                const data = await res.json();
                
                const board = document.getElementById('dashboard');
                board.innerHTML = ''; 

                // Her cihaz iÃ§in dÃ¶ngÃ¼
                for (const [device, state] of Object.entries(data)) {
                    
                    let statusClass = "status-off"; // VarsayÄ±lan renk
                    let displayState = state.toUpperCase(); // VarsayÄ±lan yazÄ±
                    let icon = icons[device] || 'â“';

                    // --- MANTIK 1: Termostat ModlarÄ± ---
                    if (state.startsWith("set_mode_")) {
                        // Class ismi Ã¶rn: 'status-set_mode_cool' (CSS ile eÅŸleÅŸir)
                        statusClass = `status-${state}`; 
                        
                        // Ekranda 'SET_MODE_COOL' yerine sadece 'COOL' yazsÄ±n
                        displayState = state.replace("set_mode_", "").toUpperCase();
                    } 
                    // --- MANTIK 2: Standart Cihazlar ---
                    else {
                        // Pozitif durumlar listesi
                        const positive = ['on', 'open', 'unlocked', 'unlock', 'auto'];
                        
                        if (positive.includes(state.toLowerCase())) {
                            statusClass = "status-on";
                        } else {
                            statusClass = "status-off";
                        }
                    }

                    // Kart HTML'ini oluÅŸtur
                    board.innerHTML += `
                        <div class="card">
                            <span class="icon">${icon}</span>
                            <h3>${device.toUpperCase().replace(/_/g, ' ')}</h3>
                            <p class="${statusClass}">
                                ${displayState}
                            </p>
                        </div>
                    `;
                }
            } catch (e) { 
                console.error("BaÄŸlantÄ± hatasÄ±:", e); 
            }
        }

        // Her 1 saniyede bir gÃ¼ncelle
        setInterval(update, 1000);
        
        // Sayfa aÃ§Ä±lÄ±nca hemen bir kez Ã§alÄ±ÅŸtÄ±r
        update();
    </script>
</body>
</html>